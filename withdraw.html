<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Beni-Wealth ‚Äî Withdraw</title>

  <!-- Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300,400,600,700&display=swap" rel="stylesheet"/>

  <!-- Favicons & Social preview -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <meta name="msapplication-TileImage" content="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Beni-Wealth ‚Äî Earn Steadily">
  <meta property="og:description" content="Complete simple micro-tasks, complete ptcs and blogs, complete shortlinks and earn instantly. Advertise efficiently with transparent metrics and fast payouts.">
  <meta property="og:image" content="https://res.cloudinary.com/dq7fpxfbc/image/upload/c_fill,w_1200,h_630/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#2fe0b8">

  <style>
    :root{
      --bg-1: #0b0613;
      --bg-2: #0f0820;
      --muted: rgba(255,255,255,0.62);
      --text: #eaf2ff;
      --accent-a: #8446ff;
      --accent-b: #6ce2c8;
      --accent-grad: linear-gradient(135deg, var(--accent-a), #5b3bff 45%, var(--accent-b) 100%);
      --glass: rgba(255,255,255,0.03);
      --container-w: 420px;
      font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100%;
      background:
        radial-gradient(1000px 600px at 10% 10%, rgba(123,61,255,0.10), transparent),
        radial-gradient(900px 500px at 90% 90%, rgba(47,224,184,0.06), transparent),
        linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      justify-content:center;
      padding:20px;
    }

    /* phone container */
    .phone {
      width:100%;
      max-width:var(--container-w);
      min-height:760px;
      border-radius:28px;
      padding:18px 18px 120px; /* room for fixed nav */
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 20px 70px rgba(0,0,0,0.6);
      overflow:auto;
      position:relative;
    }

    /* header */
    .top {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:16px;
    }
    .leftTop { display:flex; gap:12px; align-items:center; }
    .btn-back {
      padding:10px 12px;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      color:var(--text);
      text-decoration:none;
      font-weight:700;
      cursor:pointer;
    }
    .page-title { font-size:18px; font-weight:800; }
    .page-sub { color:var(--muted); font-size:12px; }

    /* main panel (glass) */
    .panel {
      border-radius:18px;
      padding:16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.03);
      box-shadow: 0 18px 60px rgba(0,0,0,0.45);
    }

    .header-row {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    .balance { color:var(--muted); font-size:13px; }
    .records-link {
      padding:8px 12px;
      border-radius:10px;
      background: linear-gradient(90deg,var(--accent-b),var(--accent-a));
      color:#041219;
      font-weight:700;
      text-decoration:none;
      border:none;
      cursor:pointer;
    }

    /* form */
    form{ display:grid; gap:12px; margin-top:6px; }
    label { display:block; }
    .field-label { color:var(--muted); font-size:13px; margin-bottom:6px; }
    input[type="text"], input[type="number"], select, textarea {
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.03);
      background: rgba(255,255,255,0.01);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    input:focus, select:focus, textarea:focus { box-shadow: 0 8px 30px rgba(87,52,164,0.08); border-color: rgba(92,73,255,0.35); }

    .note { font-size:12px; color:var(--muted); margin-top:6px; }

    .form-row { display:flex; gap:10px; justify-content:space-between; align-items:center; }
    .form-actions { display:flex; gap:8px; align-items:center; }

    .btn-primary {
      padding:10px 16px;
      border-radius:12px;
      background: linear-gradient(90deg,var(--accent-b),var(--accent-a));
      color:#041219;
      font-weight:800;
      border:none;
      cursor:pointer;
      box-shadow: 0 10px 30px rgba(87,52,164,0.14);
    }
    .btn-ghost {
      padding:10px 14px;
      border-radius:12px;
      background: transparent;
      border:1px solid rgba(255,255,255,0.04);
      color:var(--muted);
      cursor:pointer;
    }

    .form-error { color:#fb6b6b; font-size:13px; min-height:18px; }
    .toast {
      position: fixed;
      right:18px;
      bottom:18px;
      padding:12px 14px;
      border-radius:10px;
      color:#fff;
      font-weight:700;
      z-index:2000;
      transform-origin:bottom right;
    }

    /* bottom nav */
    .bottom-nav {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 20px;
      height: 74px;
      width: calc(min(var(--container-w), 100%) - 28px);
      max-width: var(--container-w);
      background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius: 38px;
      padding: 10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.04);
      z-index: 999;
      backdrop-filter: blur(6px);
    }
    .nav-btn{ width:56px; text-align:center; color:var(--muted); font-size:11px; display:flex; flex-direction:column; align-items:center; gap:6px; cursor:pointer; user-select:none; }
    .icon-wrap{ width:44px; height:44px; border-radius:10px; display:grid; place-items:center; background: rgba(255,255,255,0.02); font-size:18px; }

    /* contact FAB */
    .contact-fab {
      position: fixed;
      bottom: 110px;
      left: 50%;
      transform: translateX(calc(var(--container-w) / 2 - 72px));
      width:56px; height:56px; border-radius:50%;
      display:grid; place-items:center; font-size:20px;
      background: linear-gradient(135deg,#35d6b1,#5e47ff);
      color:#041219; box-shadow:0 18px 50px rgba(87,52,164,0.18);
      z-index: 1200; text-decoration:none; border:none; cursor:pointer;
    }

    @media(max-width:480px){
      body{ padding:14px; }
      .phone{ min-height:calc(100vh - 40px); padding-bottom:140px; border-radius:20px; }
      .bottom-nav { left:14px; right:14px; transform:none; width:auto; max-width: calc(100% - 28px); }
      .contact-fab { left:auto; right:20px; transform:none; bottom:100px; }
    }
    @media(min-width:900px){
      .phone{ max-width:480px; }
      .contact-fab { transform: translateX(calc(var(--container-w) / 2 - 72px)); }
    }
  </style>
</head>
<body>
  <div class="phone" role="main" aria-live="polite">
    <div class="top">
      <div class="leftTop">
        <button id="backBtn" class="btn-back" aria-label="Back to dashboard">‚Üê Back</button>
        <div>
          <div class="page-title">Request Withdrawal</div>
          <div class="page-sub">Fill the details below to request a withdrawal.</div>
        </div>
      </div>

      <div style="text-align:right">
        <div id="balanceDisplay" class="balance">Balance: ‚Ç¶0</div>
        <a id="recordsLink" href="withdrawal-record.html" class="records-link" style="display:inline-block;margin-top:8px">Records</a>
      </div>
    </div>

    <section class="panel" aria-label="Withdraw form panel">
      <form id="withdrawForm" novalidate>
        <label>
          <div class="field-label">Account name</div>
          <input id="accountName" required type="text" placeholder="John Doe" />
        </label>

        <label>
          <div class="field-label">Account number</div>
          <input id="accountNumber" required inputmode="numeric" type="text" maxlength="10" placeholder="0123456789" />
          <div class="note">Most Nigerian banks use 10-digit account numbers ‚Äî we'll validate this.</div>
        </label>

        <label>
          <div class="field-label">Bank</div>
          <select id="bank" required>
            <option value="">Select bank</option>
            <option>OPay</option>
            <option>Palmpay</option>
            <option>Kuda</option>
            <option>Access Bank</option>
            <option>GTBank (Guaranty Trust Bank)</option>
            <option>Zenith Bank</option>
            <option>First Bank</option>
            <option>UBA (United Bank for Africa)</option>
            <option>Fidelity Bank</option>
            <option>Stanbic IBTC</option>
            <option>Sterling Bank</option>
            <option>Premium Trust</option>
            <option>FCMB</option>
            <option>Polaris Bank</option>
            <option>Keystone Bank</option>
            <option>Wema Bank</option>
            <option>Union Bank</option>
            <option>Ecobank</option>
            <option>Heritage Bank</option>
            <option>Globus Bank</option>
            <option>Citibank</option>
            <option>Jaiz Bank</option>
            <option>Unity Bank</option>
            <option>StanChart (Standard Chartered)</option>
          </select>
        </label>

        <label>
          <div class="field-label">Amount (‚Ç¶)</div>
          <input id="amount" required type="number" min="200" step="1" placeholder="200" />
          <div class="note">Minimum withdrawal amount is ‚Ç¶200.</div>
        </label>

        <div class="form-row">
          <div id="formMsg" class="form-error"></div>
          <div class="form-actions">
            <button id="submitBtn" type="submit" class="btn-primary">Request</button>
            <button id="clearBtn" type="button" class="btn-ghost">Clear</button>
          </div>
        </div>
      </form>

    </section>
  </div>

  <!-- bottom navigation & contact FAB -->
  <div class="bottom-nav" role="navigation" aria-label="Main navigation">
    <div id="navHome" class="nav-btn" title="Home">
      <div class="icon-wrap">üè†</div>
      <div style="font-size:11px;color:var(--muted)">Home</div>
    </div>

    <div id="navConvert" class="nav-btn" title="Shortlinks">
      <div class="icon-wrap">üîó</div>
      <div style="font-size:11px;color:var(--muted)">shortlinks</div>
    </div>

    <div class="nav-center" style="flex:0 0 92px;display:flex;justify-content:center;align-items:center">
      <button id="navCenter" class="icon-wrap" style="width:78px;height:78px;border-radius:50%;background:linear-gradient(135deg,#7a5fff,#35d6b1);transform:translateY(-18px);font-size:26px;display:grid;place-items:center;border:none;cursor:pointer">‚ûï</button>
    </div>

    <div id="navNews" class="nav-btn" title="News">
      <div class="icon-wrap">üí¨</div>
      <div style="font-size:11px;color:var(--muted)">News</div>
    </div>

    <div id="navAssets" class="nav-btn" title="Assets">
      <div class="icon-wrap">üë§</div>
      <div style="font-size:11px;color:var(--muted)">Assets</div>
    </div>
  </div>

  <a id="contactFab" class="contact-fab" href="contact.html" title="Contact support" aria-label="Contact support">üí¨</a>

  <div id="statusToast" class="toast" style="display:none"></div>

  <script type="module">
    // ---------- FIREBASE CONFIG ----------
    import { initializeApp, getApps } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import {
      getFirestore, collection, addDoc, serverTimestamp, doc, runTransaction, onSnapshot
    } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDy_L7uJeoaWXbUB-LVk_fBv8yHeRjNjZk",
      authDomain: "beni-wealths.firebaseapp.com",
      projectId: "beni-wealths",
      storageBucket: "beni-wealths.firebasestorage.app",
      messagingSenderId: "807950483822",
      appId: "1:807950483822:web:e10fa87307e041c4d8417f",
      measurementId: "G-Z2XP3YN6NS"
    };

    if (!getApps().length) initializeApp(firebaseConfig);
    const db = getFirestore();
    const auth = getAuth();

    // ---------- UI refs ----------
    const form = document.getElementById('withdrawForm');
    const accountNameEl = document.getElementById('accountName');
    const accountNumberEl = document.getElementById('accountNumber');
    const bankEl = document.getElementById('bank');
    const amountEl = document.getElementById('amount');
    const formMsg = document.getElementById('formMsg');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const statusToast = document.getElementById('statusToast');
    const balanceDisplay = document.getElementById('balanceDisplay');
    const backBtn = document.getElementById('backBtn');

    let currentUser = null;
    let currentBalance = 0;
    const MIN_WITHDRAWAL = 200; // updated to ‚Ç¶200
    let userUnsub = null;

    function showToast(message, isError = false){
      statusToast.textContent = message;
      statusToast.style.display = 'block';
      statusToast.style.background = isError ? '#fb5560' : 'linear-gradient(90deg,var(--accent-b),var(--accent-a))';
      statusToast.style.color = '#041219';
      setTimeout(()=> { statusToast.style.display = 'none'; }, 3500);
    }

    function setFormError(msg){ formMsg.textContent = msg; formMsg.className = 'form-error'; }
    function clearFormError(){ formMsg.textContent = ''; formMsg.className = ''; }

    function formatN(n){ return '‚Ç¶' + Number(n || 0).toLocaleString('en-NG'); }

    // auth state: subscribe to users/{uid} to get live balance
    onAuthStateChanged(auth, (user) => {
      currentUser = user;
      if(user){
        const uRef = doc(db, 'users', user.uid);
        if(userUnsub) userUnsub();
        userUnsub = onSnapshot(uRef, (snap) => {
          const d = snap.exists() ? snap.data() : {};
          currentBalance = Number(d.balance || 0);
          balanceDisplay.textContent = `Balance: ${formatN(currentBalance)}`;
          submitBtn.disabled = currentBalance < MIN_WITHDRAWAL;
        }, (err) => {
          console.error('user doc listener error', err);
        });
      } else {
        if(userUnsub) userUnsub(); userUnsub = null;
        currentBalance = 0;
        balanceDisplay.textContent = `${formatN(0)} (sign in required)`;
        submitBtn.disabled = true;
      }
    });

    function validateInputs(){
      const accountName = accountNameEl.value.trim();
      const accountNumber = accountNumberEl.value.trim();
      const bank = bankEl.value.trim();
      const amount = Number(amountEl.value);

      if (!accountName) return { ok:false, msg: 'Account name is required.' };
      if (!/^[0-9]{10}$/.test(accountNumber)) return { ok:false, msg: 'Account number must be 10 digits.' };
      if (!bank) return { ok:false, msg: 'Please select a bank.' };
      if (!amount || isNaN(amount)) return { ok:false, msg: 'Enter a valid amount.' };
      if (amount < MIN_WITHDRAWAL) return { ok:false, msg: `Minimum withdrawal is ${formatN(MIN_WITHDRAWAL)}.` };
      return { ok:true, data: { accountName, accountNumber, bank, amount } };
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearFormError();

      if(!currentUser){ setFormError('Please sign in to request a withdrawal.'); return; }

      const check = validateInputs();
      if(!check.ok){ setFormError(check.msg); return; }

      const { accountName, accountNumber, bank, amount } = check.data;

      submitBtn.disabled = true; submitBtn.textContent = 'Processing...';

      try {
        const userRef = doc(db, 'users', currentUser.uid);

        await runTransaction(db, async (tx) => {
          const uSnap = await tx.get(userRef);
          if(!uSnap.exists()) throw new Error('User account not found');
          const uData = uSnap.data();
          const bal = Number(uData.balance || 0);
          if(bal < amount) throw new Error('INSUFFICIENT_FUNDS');

          const newBal = bal - amount;
          tx.set(userRef, { balance: newBal }, { merge: true });

          const withdrawRef = doc(collection(db, 'withdrawal'));
          tx.set(withdrawRef, {
            accountName, accountNumber, bank, amount,
            status: 'pending', requestedBy: currentUser.uid, createdAt: serverTimestamp()
          });

          const txRef = doc(collection(db, 'transactions'));
          tx.set(txRef, {
            userId: currentUser.uid,
            type: 'debit',
            source: 'withdrawal_request',
            amount: amount,
            balanceAfter: newBal,
            createdAt: serverTimestamp(),
            meta: { withdrawalRef: withdrawRef.id }
          });
        });

        showToast('Withdrawal requested and debited from your balance.');
        form.reset();
      } catch (err) {
        console.error('withdraw err', err);
        if(err && err.message === 'INSUFFICIENT_FUNDS'){
          setFormError('Insufficient balance for this withdrawal.');
        } else if(err && err.message === 'User account not found'){
          setFormError('Account data not found ‚Äî contact support.');
        } else {
          setFormError('Unable to submit withdrawal. Try again later.');
        }
      } finally {
        submitBtn.disabled = false; submitBtn.textContent = 'Request';
      }
    });

    clearBtn.addEventListener('click', () => form.reset());

    // navigation controls
    backBtn.addEventListener('click', () => location.href = 'dashboard.html');
    document.getElementById('recordsLink').addEventListener('click', (e)=>{ /* default anchor works */ });

    // bottom nav actions (update to your pages)
    document.getElementById('navHome').addEventListener('click', ()=> location.href = 'catalog.html');
    document.getElementById('navConvert').addEventListener('click', ()=> location.href = 'convert.html');
    document.getElementById('navCenter').addEventListener('click', ()=> location.href = 'center.html');
    document.getElementById('navNews').addEventListener('click', ()=> location.href = 'news.html');
    document.getElementById('navAssets').addEventListener('click', ()=> location.href = 'dashboard.html');

    // contact FAB keyboard support
    document.getElementById('contactFab').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') window.location.href = 'contact.html';
    });
  </script>
</body>
</html>
