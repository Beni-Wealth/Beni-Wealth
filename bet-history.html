<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Beni-Wealth — Bet History</title>

<!-- Poppins & favicon matching dashboard -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<link rel="icon" type="image/png" sizes="32x32"
      href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
<meta name="theme-color" content="#2fe0b8">

<style>
  :root {
    --bg-1: #0b0613;
    --bg-2: #0f0820;
    --panel: rgba(255,255,255,0.03);
    --text: #eaf2ff;
    --muted: rgba(255,255,255,0.6);
    --accent-a: #4a6eff;
    --accent-b: #2e99f8;
    --accent-grad: linear-gradient(135deg, var(--accent-a), var(--accent-b));
    --radius: 14px;
    --container-w: 480px;
  }
  *{box-sizing:border-box;}
  html,body{margin:0;padding:0;width:100%;height:100%;font-family:'Poppins',Arial;background:var(--bg-1);color:var(--text);}
  body{display:flex;justify-content:center;align-items:flex-start;padding-top:20px;}

  /* phone container */
  .phone {
    width:100%;
    max-width:var(--container-w);
    padding:18px;
    border-radius:18px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: 0 14px 40px rgba(0,0,0,0.6);
    min-height:80vh;
  }
  h2 {
    text-align:center;
    font-size:20px;
    color:var(--accent-a);
    margin:0 0 16px;
  }

  .btn-refresh {
    width:100%;
    background:var(--accent-grad);
    color:#041219;
    padding:12px;
    border:none;
    border-radius:12px;
    font-weight:700;
    cursor:pointer;
    margin-bottom:16px;
  }

  .history-list { list-style:none; padding:0; margin:0;}
  .history-item {
    background: var(--panel);
    border: 1px solid rgba(255,255,255,0.08);
    padding:14px;
    border-radius:var(--radius);
    margin-bottom:12px;
  }
  .history-item h3 {
    margin:0 0 6px;
    font-size:16px;
    color:var(--accent-b);
  }
  .history-item p { margin:4px 0; font-size:14px; color:var(--text); }

  .loading, .empty-msg { text-align:center; color:var(--muted); margin-top:20px; font-size:14px; }

  .btn-back {
    display:block;
    text-align:center;
    width:100%;
    margin-top:24px;
    padding:12px;
    border-radius:12px;
    background:rgba(255,255,255,0.05);
    border:1px solid rgba(255,255,255,0.08);
    color:var(--muted);
    font-size:14px;
    font-weight:600;
    cursor:pointer;
    text-decoration:none;
  }
</style>
</head>
<body>
  <div class="phone">
    <h2>Your Betting History</h2>
    <button class="btn-refresh" id="refreshBtn">Refresh</button>
    <div id="historyContainer">
      <div class="loading" id="loadingMsg">Loading history...</div>
    </div>
    <div class="btn-back" id="goBack">Back to Stake</div>
  </div>

<script type="module">
import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {
  getFirestore, collection, query, where, getDocs, orderBy
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDy_L7uJeoaWXbUB-LVk_fBv8yHeRjNjZk",
  authDomain: "beni-wealths.firebaseapp.com",
  projectId: "beni-wealths",
  storageBucket: "beni-wealths.appspot.com",
  messagingSenderId: "807950483822",
  appId: "1:807950483822:web=e10fa87307e041c4d8417f",
  measurementId: "G-Z2XP3YN6NS"
};

if (!getApps().length) initializeApp(firebaseConfig);

const auth = getAuth();
const db = getFirestore();

const historyContainer = document.getElementById('historyContainer');
const loadingMsg = document.getElementById('loadingMsg');
const refreshBtn = document.getElementById('refreshBtn');
const goBack = document.getElementById('goBack');
let currentUser = null;

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "signin.html";
    return;
  }
  currentUser = user;
  await loadHistory();
});

async function loadHistory() {
  loadingMsg.style.display = 'block';
  historyContainer.innerHTML = "";
  try {
    const hQuery = query(
      collection(db,'stakes'),
      where('userId','==',currentUser.uid),
      orderBy('createdAt','desc')
    );
    const hSnap = await getDocs(hQuery);
    loadingMsg.style.display = 'none';

    if (hSnap.empty) {
      historyContainer.innerHTML = `<div class="empty-msg">No bets found.</div>`;
      return;
    }
    renderHistory(hSnap.docs);

  } catch (err) {
    console.error("History load error:", err);
    historyContainer.innerHTML = `<div class="empty-msg">Unable to load history.</div>`;
  }
}

function renderHistory(docs) {
  const list = document.createElement('ul');
  list.className = 'history-list';

  docs.forEach(docSnap => {
    const d = docSnap.data();
    const item = document.createElement('li');
    item.className = 'history-item';
    item.innerHTML = `
      <h3>${d.title || "Match"}</h3>
      <p><strong>Choice:</strong> ${d.choice || "-"}</p>
      <p><strong>Amount:</strong> ₦${(d.amount || 0).toLocaleString('en-NG',{minimumFractionDigits:2})}</p>
      <p><strong>Status:</strong> ${d.status || "-"}</p>
      <p><strong>Won:</strong> ₦${(d.wonAmount || 0).toLocaleString('en-NG',{minimumFractionDigits:2})}</p>
      <p><strong>Date:</strong> ${d.createdAt?.toDate?.().toLocaleString() || "-"}</p>
    `;
    list.appendChild(item);
  });

  historyContainer.appendChild(list);
}

refreshBtn.addEventListener('click', loadHistory);
goBack.addEventListener('click', () => window.location.href = "stake.html");
</script>

</body>
</html>
