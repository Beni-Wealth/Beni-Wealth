<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Beni-Wealth ‚Äî Snakes & Ladders</title>
  <meta name="theme-color" content="#2fe0b8" />

  <!-- Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32"
        href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">

  <style>
    :root{
      --bg:#041225; --card:#0b1220;
      --accent:#7a5fff; --accent-2:#35d6b1;
      --muted:rgba(255,255,255,0.66);
      font-family:Poppins, system-ui, Arial;
      color:#eaf2ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#031022);display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:12px}

    .back-btn{
      align-self:flex-start;margin-bottom:8px;padding:8px 12px;border-radius:8px;
      background:var(--accent-2);color:#041219;font-weight:700;text-decoration:none;
    }

    .app{width:100%;max-width:1000px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:16px;display:grid;grid-template-columns:1fr 350px;gap:12px;box-shadow:0 30px 80px rgba(2,6,23,0.7);margin-top:8px}
    @media(max-width:800px){ .app{grid-template-columns:1fr;max-width:480px;padding:12px} }
    .board-wrap{padding:12px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:10px;border:1px solid rgba(255,255,255,0.03);position:relative}
    .controls{padding:12px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:10px}

    #board {
      position: relative;
      width:100%;
      aspect-ratio:1/1;
      display:grid;
      grid-template-columns:repeat(10,1fr);
      gap:4px;
      background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);
      padding:4px;
      border-radius:8px;
      transform:translateY(12px);
    }

    .cell{background:linear-gradient(180deg,rgba(255,255,255,0.012),transparent);border-radius:6px;display:block;padding:4px;font-size:12px;color:var(--muted);position:relative}
    .cell .num{position:absolute;left:4px;top:4px;font-weight:800;color:var(--muted);font-size:12px;z-index:2}

    .token {
      position:absolute;
      font-size:20px;
      width:24px;height:24px;
      display:flex;place-items:center;justify-content:center;
      transform:translate(-50%,-50%);
      transition: transform 350ms ease;
      z-index:40;
    }

    #diceArea {
      margin-top:16px;
      display:flex;
      justify-content:center;
      width:100%;
    }
    .dice {
      font-size:56px;
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
      transition: transform 400ms ease;
      padding:10px;
      background:rgba(255,255,255,0.04);
      border-radius:12px;
    }

    .btn{padding:10px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#041219;font-weight:800;cursor:pointer}
    .btn-ghost{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted)}
    .status{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);font-weight:800}
    .history{height:140px;overflow:auto;border-radius:8px;padding:8px;background:rgba(255,255,255,0.01);font-size:13px}
    .small{font-size:13px;color:var(--muted)}

    .snake {background:rgba(255,0,0,0.2);border-radius:4px;}
    .ladder {background:rgba(0,255,0,0.2);border-radius:4px;}
  </style>
</head>
<body>

  <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>

  <div class="app">
    <div class="board-wrap">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div style="font-weight:900">Snakes & Ladders ‚Ä¢ Beni-Wealth</div>
        <div class="small">Player vs Bot ‚Äî fair 50/50 dice</div>
      </div>

      <div id="board"></div>

      <div id="playerToken" class="token">üßç‚Äç‚ôÇÔ∏è</div>
      <div id="botToken" class="token">ü§ñ</div>

      <div id="diceArea">
        <div id="dice" class="dice">üé≤</div>
      </div>
    </div>

    <div class="controls">
      <div class="status" id="status">Welcome ‚Äî press <strong>Start</strong></div>
      <button id="startBtn" class="btn-ghost">Start New Game</button>
      <div style="margin-top:8px">
        <div class="small">Game log</div>
        <div id="log" class="history"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp, getApps, getApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getFirestore, doc, updateDoc, increment } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDy_L7uJeoaWXbUB-LVk_fBv8yHeRjNjZk",
      authDomain: "beni-wealths.firebaseapp.com",
      projectId: "beni-wealths",
      storageBucket: "beni-wealths.firebasestorage.app",
      messagingSenderId: "807950483822",
      appId: "1:807950483822:web=e10fa87307e041c4d8417f",
      measurementId: "G-Z2XP3YN6NS"
    };

    const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const boardEl = document.getElementById('board');
    const playerToken = document.getElementById('playerToken');
    const botToken = document.getElementById('botToken');
    const diceEl = document.getElementById('dice');
    const startBtn = document.getElementById('startBtn');
    const statusEl = document.getElementById('status');
    const logEl = document.getElementById('log');

    let playerPos=1, botPos=1;
    let playerTurn=true, running=false;
    let currentUser=null;

    const snakes = {16:6, 48:38, 79:69};
    const ladders = {3:23, 42:62, 70:90};

    function buildBoard(){
      boardEl.innerHTML='';
      const SIZE=10;
      for(let r=0;r<SIZE;r++){
        const rowFromBottom=SIZE-1-r;
        const leftToRight=rowFromBottom%2===0;
        for(let c=0;c<SIZE;c++){
          const num=leftToRight
            ? (rowFromBottom*SIZE + (c+1))
            : (rowFromBottom*SIZE + (SIZE-c));
          const cell=document.createElement('div');
          cell.className='cell';
          cell.dataset.num=num;
          const n=document.createElement('div');
          n.className='num'; n.textContent=num;
          cell.appendChild(n);

          if(snakes[num]) cell.classList.add('snake');
          if(ladders[num]) cell.classList.add('ladder');

          boardEl.appendChild(cell);
        }
      }
    }

    function getCell(num){return boardEl.querySelector(`.cell[data-num="${num}"]`);}
    function placeTokens(){
      const pc=getCell(playerPos), bc=getCell(botPos);
      if(pc) pc.appendChild(playerToken);
      if(bc) bc.appendChild(botToken);
    }

    function logMsg(msg){
      const d=document.createElement('div');
      d.textContent=msg;
      logEl.prepend(d);
      if(logEl.children.length>200) logEl.removeChild(logEl.lastChild);
    }

    function rollDice(){
      diceEl.style.transform = "rotateX(720deg) rotateY(360deg)";
      const val = Math.floor(Math.random()*6)+1;
      setTimeout(()=>{diceEl.style.transform=""; diceEl.textContent=val;},600);
      return val;
    }

    async function dramaticMove(token, from, to){
      for(let next=from+1; next<=to; next++){
        const cell = getCell(next);
        if(cell) cell.appendChild(token);
        await new Promise(r=>setTimeout(r,150));
      }
    }

    async function updateBalance(delta){
      if(!currentUser) return;
      const userRef = doc(db,'users',currentUser.uid);
      await updateDoc(userRef,{balance:increment(delta)});
    }

    async function playerRoll(){
      if(!running || !playerTurn) return;
      const val = rollDice();
      logMsg("You rolled "+val);
      if(playerPos+val <= 100){
        const old = playerPos;
        playerPos+=val;
        await dramaticMove(playerToken, old, playerPos);
      }

      // Snakes or ladders
      if(snakes[playerPos]){
        logMsg("Oops! Snake bites! Drop 10 positions");
        const old=playerPos; playerPos-=10;
        await dramaticMove(playerToken, old-10, playerPos);
      } else if(ladders[playerPos]){
        logMsg("Yay! Ladder! Move up 20 positions");
        const old=playerPos; playerPos+=20;
        if(playerPos>100) playerPos=100;
        await dramaticMove(playerToken, old, playerPos);
      }

      placeTokens();
      if(playerPos>=100){endGame('player'); return;}
      playerTurn=false; setTimeout(botMove,300);
    }

    async function botMove(){
      if(!running) return;
      statusEl.textContent="Bot's turn...";
      await new Promise(r=>setTimeout(r,500));
      const val = rollDice();
      logMsg("Bot rolled "+val);
      if(botPos+val<=100){
        const old=botPos;
        botPos+=val;
        await dramaticMove(botToken, old, botPos);
      }

      if(snakes[botPos]){
        logMsg("Bot bitten by snake! -10");
        botPos-=10;
      } else if(ladders[botPos]){
        logMsg("Bot climbs ladder! +20");
        botPos+=20;
        if(botPos>100) botPos=100;
      }

      placeTokens();
      if(botPos>=100){endGame('bot'); return;}
      playerTurn=true; statusEl.textContent="Your turn";
      diceEl.textContent="üé≤";
    }

    async function startGame(){
      if(!currentUser){alert('Sign in to play'); return;}
      await updateBalance(-50); // debit for starting game
      running=true; playerTurn=true;
      playerPos=1; botPos=1;
      buildBoard(); placeTokens();
      logEl.innerHTML=''; statusEl.textContent='Your turn';
      diceEl.textContent="üé≤";
    }

    async function endGame(w){
      running=false;
      if(w=='player'){
        statusEl.textContent="You win!";
        await updateBalance(70); // credit win
      } else {
        statusEl.textContent="Bot wins!";
      }
    }

    onAuthStateChanged(auth,u=>{currentUser=u;});
    startBtn.addEventListener('click', startGame);
    diceEl.addEventListener('click', playerRoll);

    document.addEventListener('DOMContentLoaded',()=>{buildBoard(); placeTokens();});
  </script>
</body>
</html>
