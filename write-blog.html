<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Beni-Wealth â€” Write a blog</title>

  <!-- Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>

  <!-- favicon / logo -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <meta name="theme-color" content="#392E71">

  <style>
    :root{
      --bg-dark: #1A1A2E; --bg-card: #16213E; --text-light: #E0E5EC;
      --text-muted: #9AA5B1; --accent: #FFD369;
      --input-bg: #0F0F18; --border-light: #2E2E3E;
      --btn-primary: #FFD369; --btn-text: #1A1A2E;
      --shadow: rgba(0,0,0,0.4);
      font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg-dark);
      color: var(--text-light);
      display: flex;
      justify-content: center;
      padding: 32px;
    }
    .card {
      width: 100%;
      max-width: 900px;
      background: var(--bg-card);
      border-radius: 20px;
      box-shadow: 0 20px 50px var(--shadow);
      padding: 24px 30px;
    }
    h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 700;
    }
    p.lead {
      margin-top: 6px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .meta {
      display: flex;
      gap: 12px;
      align-items: center;
      margin: 16px 0;
    }
    .plan-badge {
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 700;
      background: linear-gradient(90deg,#785AFF,#35D6B1);
      color: var(--btn-text);
      font-size: 13px;
    }
    .plan-info {
      font-size: 13px;
      color: var(--text-muted);
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }
    input[type="text"], textarea, input[type="file"] {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--border-light);
      background: var(--input-bg);
      color: var(--text-light);
      font-size: 14px;
      outline: none;
      margin-bottom: 10px;
    }
    textarea {
      min-height: 250px;
      resize: vertical;
    }
    .row {
      display: grid;
      grid-template-columns: 1fr 260px;
      gap: 14px;
      align-items: start;
    }

    .btn {
      padding: 10px 16px;
      font-weight: 700;
      border-radius: 999px;
      cursor: pointer;
      font-size: 14px;
      transition: 0.2s ease;
      border: none;
    }
    .btn.primary {
      background: var(--btn-primary);
      color: var(--btn-text);
    }
    .btn.primary:hover {
      filter: brightness(1.05);
    }
    .btn.ghost {
      background: transparent;
      border: 1px solid var(--border-light);
      color: var(--text-muted);
    }
    .btn.ghost:hover {
      background: var(--border-light);
    }

    .note {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }
    .message {
      margin-top: 14px;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 13px;
    }
    .message.success {
      background: rgba(68, 255, 131, 0.1);
      color: #B9FFCB;
    }
    .message.error {
      background: rgba(255, 80, 80, 0.12);
      color: #FFBABA;
    }

    .thumb-preview {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px dashed var(--border-light);
      margin-top: 8px;
    }

    @media(max-width:880px){
      .row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="card" role="main">
    <header>
      <h1>Create a Blog Post</h1>
      <p class="lead">Only <strong>Bronze</strong>, <strong>Silver</strong>, and <strong>Gold</strong> plan users can submit posts. Unauthorized submissions are penalized.</p>
    </header>

    <div class="meta">
      <div id="planBadge" class="plan-badge">Checkingâ€¦</div>
      <div class="plan-info">Plan status is checked against <code>users/{uid}.plan</code> in Firestore.</div>
    </div>

    <form id="blogForm" novalidate>
      <div class="row">
        <div>
          <label for="title">Title</label>
          <input id="title" name="title" type="text" placeholder="Enter your post titleâ€¦" required />

          <label for="content">Content</label>
          <textarea id="content" name="content" placeholder="Write your blog content hereâ€¦" required></textarea>
          <div class="note">Paste image links in content or use the thumbnail uploader below.</div>
        </div>

        <aside>
          <label for="tags">Tags (comma separated)</label>
          <input id="tags" name="tags" type="text" placeholder="e.g., finance, tips, lifestyle" />

          <label for="thumbnail">Post Thumbnail</label>
          <input id="thumbnail" name="thumbnail" type="file" accept="image/*" />
          <img id="thumbPreview" class="thumb-preview" alt="Thumbnail preview" style="display:none"/>

          <div style="margin-top:14px; display:flex; gap:8px;">
            <button id="publishBtn" class="btn primary" type="submit">Submit for Review</button>
            <button id="saveDraft" type="button" class="btn ghost">Save Draft</button>
          </div>

          <div class="note">Penalty for unauthorized submit: <strong id="penaltyAmt">â‚¦30</strong></div>
        </aside>
      </div>

      <div id="statusArea" aria-live="polite"></div>
    </form>
  </div>

  <!-- Firebase + Script logic unchanged -->
  <script type="module">
    // â€¦ (your existing script, unchanged except plan check below)
    
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      clearMessage();
      if(!currentUser){ showMessage('You must be signed in to submit.', 'error'); return; }

      const title = document.getElementById('title').value.trim();
      const content = document.getElementById('content').value.trim();
      const tags = document.getElementById('tags').value.split(',').map(t=>t.trim()).filter(Boolean);
      const thumbFile = thumbInput.files && thumbInput.files[0];

      if(!title) return showMessage('Please enter a title', 'error');
      if(!content) return showMessage('Please enter the content', 'error');

      publishBtn.disabled = true; publishBtn.textContent = 'Checking planâ€¦';

      try {
        const uRef = doc(db, 'users', currentUser.uid);
        const snap = await getDoc(uRef);
        const plan = (snap.exists() && (snap.data().plan || '') ).toString().toLowerCase();

        // ðŸ”„ ALLOWED plans updated
        if(['bronze','silver','gold'].includes(plan)) {
          publishBtn.textContent = 'Uploading thumbnailâ€¦';
          let thumbUrl = null;
          if(thumbFile){ thumbUrl = await uploadThumbnailToImgur(thumbFile); }

          publishBtn.textContent = 'Submittingâ€¦';
          const blogsCol = collection(db, 'blogs');
          const payload = {
            userId: currentUser.uid,
            author: snap.exists() ? (snap.data().username || currentUser.displayName || currentUser.email) : currentUser.email,
            title, content, tags,
            thumbnail: thumbUrl || null,
            status:'pending', createdAt: serverTimestamp()
          };
          const docRef = await addDoc(blogsCol, payload);
          showMessage('Post submitted for review (ID: ' + docRef.id + ').', 'success');
          form.reset(); thumbPreview.style.display='none';
        } else {
          await applyPenalty('Unauthorized blog submit attempt');
          showMessage(`Not allowed (plan: ${plan || 'none'}). Penalty applied.`, 'error');
        }
      } catch(err) {
        showMessage('Submission failed. Try again later.', 'error');
      } finally {
        publishBtn.disabled=false; publishBtn.textContent='Submit for Review';
      }
    });
  </script>
</body>
</html>
