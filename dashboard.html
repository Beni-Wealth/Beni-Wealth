<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Beni-Wealth — Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #F7F3E3;
      --panel: #FFFFFF;
      --ink: #0B2545;
      --muted: #6B7A8A;
      --accent: #1976D2;
      --success: #2e7d32;
      --radius: 12px;
      --maxw: 980px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Poppins',Segoe UI,Roboto,Arial;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased;}
    body{display:flex;justify-content:center;padding:20px 16px 60px;}

    /* header - pointer-events: auto so the hamburger receives clicks */
    header.app-header{
      position:fixed; left:50%; transform:translateX(-50%); top:12px;
      width:100%; max-width:var(--maxw); height:64px; z-index:1300;
      display:flex; align-items:center; justify-content:space-between; padding:8px 12px;
      pointer-events:auto;
      background:rgba(255,255,255,0.6); backdrop-filter: blur(4px); border-radius:10px;
      box-shadow:0 10px 30px rgba(11,37,69,0.04);
    }
    .header-inner{ display:flex; align-items:center; gap:12px; width:100%; justify-content:space-between;}
    .left-controls{display:flex;align-items:center;gap:10px}
    .hamburger{width:52px;height:52px;border-radius:12px;background:var(--panel);display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 8px 28px rgba(11,37,69,0.06);border:1px solid rgba(11,37,69,0.04);transition:transform .18s}
    .hamburger .bar{width:20px;height:2px;background:var(--ink);display:block;margin:3px 0;border-radius:2px;transition:transform .18s, opacity .12s}
    .hamburger.open .bar:nth-child(1) { transform: translateY(6px) rotate(45deg); }
    .hamburger.open .bar:nth-child(2) { opacity:0; transform: scale(0); }
    .hamburger.open .bar:nth-child(3) { transform: translateY(-6px) rotate(-45deg); }

    .icon-btn{width:44px;height:44px;border-radius:12px;background:var(--panel);display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid rgba(11,37,69,0.03)}
    .brand img{height:44px;border-radius:10px;box-shadow:0 10px 30px rgba(11,37,69,0.06)}

    main.stage{width:100%; max-width:var(--maxw); margin-top:96px; display:grid; gap:20px;}

    /* left sidebar (overlay) */
    .sidebar {
      position:fixed; left:0; top:0; height:100vh; width:100%;
      transform:translateX(-100%);
      background:rgba(255,255,255,0.98); box-shadow:2px 0 24px rgba(0,0,0,0.08); z-index:2200; overflow:auto;
      transition: transform .34s cubic-bezier(.2,.9,.3,1);
      display:flex; flex-direction:column; gap:12px; padding:18px; border-top-right-radius:14px; border-bottom-right-radius:14px;
      will-change: transform;
    }
    @media(min-width:1100px){
      .sidebar { width: clamp(420px, 36vw, 520px); left: calc(50% - 260px); border-radius:14px; top:28px; height:calc(100vh - 56px); }
      .sidebar.open { transform:translateX(0); left: calc(50% - 260px); }
    }
    .sidebar.open { transform:translateX(0); }

    .side-head { display:flex; align-items:center; gap:12px; justify-content:space-between; }
    .avatar-wrap{display:flex;align-items:center;gap:12px}
    #avatar {
      width:72px;height:72px;border-radius:14px;background:linear-gradient(180deg,#1976D2,#115293);color:#fff;font-weight:700;font-size:28px;
      display:flex;align-items:center;justify-content:center;overflow:hidden;
    }
    #avatar img { width:100%; height:100%; object-fit:cover; display:block; }

    .user-meta { display:flex; flex-direction:column; gap:6px; }
    .user-meta .name { font-size:16px; font-weight:700; color:var(--ink); }
    .user-meta .uid { font-size:13px; color:var(--muted); }
    .ref-row { display:flex; align-items:center; gap:8px; font-size:13px; color:var(--muted); }
    .ref-row button { padding:6px 8px; border-radius:8px; border:none; background:var(--accent); color:#fff; cursor:pointer; font-weight:600; }

    .close-x { background:transparent;border:none;font-size:22px;cursor:pointer;color:var(--accent); }

    nav.side-nav{margin-top:12px;display:flex;flex-direction:column;gap:8px;padding-right:8px}
    .nav-item { display:flex; align-items:center; gap:12px; padding:10px; border-radius:10px; text-decoration:none; color:var(--ink); background:transparent; transition: background .12s, transform .12s; }
    .nav-item:focus, .nav-item:hover { background: rgba(25,118,210,0.04); transform: translateY(-2px); outline: none; }
    .nav-emoji{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;background:rgba(25,118,210,0.08)}
    .nav-label{font-weight:600}

    .side-footer{margin-top:auto;font-size:13px;color:var(--muted);display:flex;justify-content:space-between;align-items:center;gap:8px}

    .backdrop{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.24);opacity:0;pointer-events:none;z-index:2100;transition:opacity .22s}
    .backdrop.visible{opacity:1;pointer-events:auto}

    /* content layout */
    .container{max-width:980px;margin:0 auto;display:grid;grid-template-columns:1fr 360px;gap:20px;align-items:start}
    .left-col{display:flex;flex-direction:column;gap:16px}
    .card{background:var(--panel);border-radius:12px;padding:16px;box-shadow:0 6px 24px rgba(11,37,69,0.05)}
    .big-balance{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:22px;border-radius:12px}
    .label{font-weight:700;color:var(--muted)}
    .amount{font-size:36px;color:var(--accent);font-weight:800}

    .stats-row{display:flex;gap:12px}
    .stat{flex:1;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(25,118,210,0.04), rgba(25,118,210,0.01));text-align:center}
    .stat .num{font-weight:800;font-size:18px}
    .stat .lbl{color:var(--muted);font-size:13px;margin-top:6px}

    .right-col{display:flex;flex-direction:column;gap:12px}
    .tx-list table{width:100%;border-collapse:collapse}
    .tx-list th,.tx-list td{text-align:left;padding:8px 0;border-bottom:1px solid #f3f3f3;font-size:14px;color:var(--ink)}
    .tx-list thead th{color:var(--muted);font-weight:700;border-bottom:2px solid #eee}

    .upload-row{display:flex;flex-direction:column;gap:8px;margin-top:10px}

    .progress-wrap{margin-top:8px}
    .progress{height:8px;background:#e9f3ff;border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#3aa0ff)}

    .toast{position:fixed;right:20px;bottom:26px;background:var(--panel);padding:10px 14px;border-radius:10px;box-shadow:0 10px 30px rgba(11,37,69,0.08);border-left:4px solid var(--accent);z-index:2400;display:none}
    .toast.show{display:block}

    @media (max-width:980px){ .container{grid-template-columns:1fr} .right-col{order:2} .sidebar.open{width:100%} }
  </style>
</head>
<body>
  <!-- on-page error logger (visible for Acode/mobile) -->
  <pre id="__dev_errors" style="position:fixed;left:8px;right:8px;bottom:8px;max-height:34vh;overflow:auto;background:rgba(0,0,0,0.78);color:#fff;padding:10px;border-radius:8px;font-family:monospace;font-size:12px;z-index:999999;display:none"></pre>

  <!-- toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- backdrop -->
  <div id="backdrop" class="backdrop" aria-hidden="true"></div>

  <!-- sidebar -->
  <aside id="sidebar" class="sidebar" aria-hidden="true" aria-modal="true" role="dialog">
    <div class="side-head">
      <div class="avatar-wrap">
        <div id="avatar" aria-hidden="true">U</div>
        <div class="user-meta">
          <div id="sb-name" class="name">User</div>
          <div id="sb-uid" class="uid">UID: -----</div>
          <div class="ref-row">Referral: <strong id="ref-code">-</strong><button id="copy-ref">Copy</button></div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <button id="side-notif" class="icon-btn" title="Notifications">🔔</button>
        <button id="side-profile" class="icon-btn" title="Profile">👤</button>
        <button id="close-x" class="close-x" aria-label="Close menu">×</button>
      </div>
    </div>

    <div class="card">
      <div style="font-weight:700;margin-bottom:8px">Profile photo</div>
      <div class="upload-row">
        <input id="photo-input" type="file" accept="image/*" style="padding:6px" aria-label="Choose profile photo" />
        <div id="preview-wrap" style="display:flex;align-items:center;gap:12px">
          <div id="preview" style="width:72px;height:72px;border-radius:12px;background:#f3f3f3;display:flex;align-items:center;justify-content:center;color:#777">Preview</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button id="upload-btn" style="padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer">Upload Photo</button>
            <div id="upload-status" style="font-size:13px;color:var(--muted)"></div>
            <div id="upload-progress" class="progress-wrap" style="display:none">
              <div class="progress" aria-hidden="true"><i id="upload-progress-bar"></i></div>
              <div id="upload-percent" style="font-size:12px;color:var(--muted);margin-top:6px">0%</div>
            </div>
          </div>
        </div>
        <div style="font-size:12px;color:var(--muted);margin-top:6px">Max size 2.5MB (will compress if needed). Square images work best.</div>
      </div>
    </div>

    <nav id="side-nav" class="side-nav" aria-label="Sidebar navigation">
      <a class="nav-item" href="tasks.html"><div class="nav-emoji task-emoji">🧾</div><div class="nav-label">Completed Tasks</div></a>
      <a class="nav-item" href="orders.html"><div class="nav-emoji">📦</div><div class="nav-label">Orders</div></a>
      <a class="nav-item" href="shortlinks.html"><div class="nav-emoji">🔗</div><div class="nav-label">Shortlinks</div></a>
      <a class="nav-item" href="terms.html"><div class="nav-emoji">📜</div><div class="nav-label">Terms</div></a>
      <a class="nav-item" href="contact.html"><div class="nav-emoji">✉️</div><div class="nav-label">Contact Us</div></a>
      <a id="signout-btn" class="nav-item" href="#"><div class="nav-emoji">⛔</div><div class="nav-label">Sign out</div></a>
    </nav>

    <div class="side-footer">
      <div style="font-size:13px;color:var(--muted)">Beni-Wealth • v1.0</div>
      <a href="profile.html" style="text-decoration:none;color:var(--accent);font-weight:600">View profile</a>
    </div>
  </aside>

  <!-- header -->
  <header class="app-header">
    <div class="header-inner">
      <div class="left-controls">
        <button id="menu-btn" class="hamburger" aria-label="Open menu" title="Menu" aria-expanded="false">
          <span style="display:flex;flex-direction:column;align-items:center">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
          </span>
        </button>
        <div class="brand"><img src="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png" alt="logo"></div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;pointer-events:auto">
        <button id="top-notif" class="icon-btn" title="Notifications">🔔</button>
        <button id="top-profile" class="icon-btn" title="Profile"><span id="top-profile-placeholder">👤</span></button>
      </div>
    </div>
  </header>

  <!-- main content -->
  <main class="stage" role="main">
    <div class="container">
      <div class="left-col">
        <div class="card big-balance">
          <div>
            <div class="label">Main Balance</div>
            <div id="main-balance" class="amount">₦0.00</div>
            <div style="color:var(--muted);font-size:13px;margin-top:6px">Welcome back — nice to see you.</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
            <button id="withdraw-btn" style="background:var(--accent);border:none;color:#fff;padding:10px 14px;border-radius:8px;cursor:pointer">Withdraw</button>
            <button id="tasks-btn" style="border:1px solid rgba(11,37,69,0.06);background:transparent;padding:8px 12px;border-radius:8px;cursor:pointer">View Tasks</button>
          </div>
        </div>

        <div class="stats-row">
          <div class="stat card">
            <div class="num" id="completed-count">0</div>
            <div class="lbl">Completed Tasks</div>
          </div>
          <div class="stat card">
            <div class="num" id="orders-count">0</div>
            <div class="lbl">Orders</div>
          </div>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div style="font-weight:700">Quick Actions</div>
            <div style="color:var(--muted);font-size:13px">Shortcuts</div>
          </div>
          <div style="display:flex;gap:10px;margin-top:12px">
            <button id="start-task" style="background:var(--accent);color:#fff;padding:10px;border-radius:8px;border:none;cursor:pointer">Start Task</button>
            <button id="complete-shortlink" style="border:1px solid rgba(11,37,69,0.06);padding:10px;border-radius:8px;background:transparent;cursor:pointer">Complete Shortlink</button>
            <button id="invite" style="border:1px solid rgba(11,37,69,0.06);padding:10px;border-radius:8px;background:transparent;cursor:pointer">Invite</button>
          </div>
        </div>
      </div>

      <aside class="right-col">
        <div class="card tx-list">
          <h3 style="margin-top:0">Recent Transactions</h3>
          <table>
            <thead><tr><th>Type</th><th>Date</th><th style="text-align:right">Amount</th></tr></thead>
            <tbody id="txn-body"><tr><td colspan="3" style="text-align:center;color:var(--muted);padding:18px">Loading...</td></tr></tbody>
          </table>
        </div>

        <div class="card leaderboard">
          <div style="display:flex;justify-content:space-between;align-items:center;"><div style="font-weight:700">Leaderboard</div><div style="color:var(--muted);font-size:13px">Top referrers</div></div>
          <ol style="margin:12px 0 0 18px;color:var(--ink)"><li style="margin-bottom:8px">Blamo — ₦12,000</li><li style="margin-bottom:8px">Ada — ₦10,200</li><li style="margin-bottom:8px">Chike — ₦8,400</li></ol>
        </div>
      </aside>
    </div>
  </main>

  <!-- Module script (Firebase + toggle + upload). Complete and robust. -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut, updateProfile } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js';
    import {
      getFirestore, doc, collection, query, where, orderBy, limit,
      onSnapshot, setDoc, getDocs, serverTimestamp
    } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js';
    import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-storage.js';

    // Beni-Wealth Firebase config (from your script)
    const firebaseConfig = {
      apiKey: "AIzaSyDy_L7uJeoaWXbUB-LVk_fBv8yHeRjNjZk",
      authDomain: "beni-wealths.firebaseapp.com",
      projectId: "beni-wealths",
      storageBucket: "beni-wealths.firebasestorage.app",
      messagingSenderId: "807950483822",
      appId: "1:807950483822:web:e10fa87307e041c4d8417f",
      measurementId: "G-Z2XP3YN6NS"
    };

    // init firebase (best-effort)
    let app, auth, db, storage;
    try {
      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);
      storage = getStorage(app);
      console.info('Firebase initialized');
      showOnPageLog('Firebase initialized');
    } catch (err) {
      console.error('Firebase init failed', err);
      showOnPageLog('Firebase init failed: ' + err.message);
    }

    // DOM-ready helper
    function onReady(fn) {
      if (document.readyState !== 'loading') fn();
      else document.addEventListener('DOMContentLoaded', fn);
    }

    // small helper to log to the on-page logger if present
    function showOnPageLog(msg) {
      try {
        const p = document.getElementById('__dev_errors');
        if (p) { p.style.display = 'block'; p.textContent += msg + '\\n'; p.scrollTop = p.scrollHeight; }
      } catch (e) { /* ignore */ }
    }

    onReady(() => {
      // DOM refs
      const menuBtn = document.getElementById('menu-btn');
      const sidebar = document.getElementById('sidebar');
      const closeX = document.getElementById('close-x');
      const backdrop = document.getElementById('backdrop');
      const sideNav = document.getElementById('side-nav');

      // make sure header/menu accept clicks and are above overlays
      const header = document.querySelector('.app-header') || document.querySelector('header');
      if (header) header.style.pointerEvents = 'auto';
      if (menuBtn) {
        menuBtn.style.pointerEvents = 'auto';
        menuBtn.style.zIndex = 3000;
      }

      // Defensive checks
      console.info('Initializing UI — found:', { menuBtn: !!menuBtn, sidebar: !!sidebar, backdrop: !!backdrop });
      showOnPageLog('Initializing UI — found elements: menuBtn=' + !!menuBtn + ', sidebar=' + !!sidebar);

      // Toggle helpers
      function openSidebar() {
        if (!sidebar || !backdrop) return;
        sidebar.classList.add('open');
        backdrop.classList.add('visible');
        sidebar.setAttribute('aria-hidden','false');
        backdrop.setAttribute('aria-hidden','false');
        document.body.style.overflow = 'hidden';
        if (menuBtn) { menuBtn.classList.add('open'); menuBtn.setAttribute('aria-expanded','true'); }
        if (closeX) closeX.focus();
        console.info('Sidebar opened');
        showOnPageLog('Sidebar opened');
      }
      function closeSidebar() {
        if (!sidebar || !backdrop) return;
        sidebar.classList.remove('open');
        backdrop.classList.remove('visible');
        sidebar.setAttribute('aria-hidden','true');
        backdrop.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
        if (menuBtn) { menuBtn.classList.remove('open'); menuBtn.setAttribute('aria-expanded','false'); menuBtn.focus(); }
        console.info('Sidebar closed');
        showOnPageLog('Sidebar closed');
      }
      function toggleSidebar(e) {
        if (e && e.preventDefault) e.preventDefault();
        if (!sidebar) return;
        sidebar.classList.contains('open') ? closeSidebar() : openSidebar();
      }

      // attach regular listeners
      if (menuBtn && !menuBtn.__sidebarAttached) {
        menuBtn.addEventListener('click', (ev) => {
          console.log('menuBtn click event received (module)');
          ev.__sidebar_handled = true;
          toggleSidebar(ev);
        });
        menuBtn.addEventListener('keydown', (ev) => { if (ev.key === 'Enter' || ev.key === ' ') toggleSidebar(ev); });
        menuBtn.__sidebarAttached = true;
      }

      if (backdrop && !backdrop.__attached) {
        backdrop.addEventListener('click', (ev) => { if (ev && ev.preventDefault) ev.preventDefault(); closeSidebar(); });
        backdrop.__attached = true;
      }

      if (closeX && !closeX.__attached) {
        closeX.addEventListener('click', (ev) => { if (ev && ev.preventDefault) ev.preventDefault(); closeSidebar(); });
        closeX.__attached = true;
      }

      if (!document.__sidebarEsc) {
        document.addEventListener('keydown', (ev) => { if (ev.key === 'Escape' && sidebar && s
