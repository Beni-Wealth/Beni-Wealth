<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Beni-Wealth — Pool Game</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg-1:#0b0710;
  --bg-2:#0e0620;
  --card:#0f1726;
  --muted:#9aa4b2;
  --accent-1:#7c3aed;
  --accent-2:#4ade80;
  --accent-grad: linear-gradient(90deg,#7c3aed,#06b6d4);
  --glass: rgba(255,255,255,0.03);
  --glass-2: rgba(255,255,255,0.02);
  --danger:#ef4444;
  --success:#10b981;
  --text:#e6eef8;
}
html,body{height:100%;margin:0;font-family:"Poppins",sans-serif;background:radial-gradient(1000px 600px at 10% 10%, rgba(124,58,237,0.12), transparent), linear-gradient(180deg,var(--bg-1), var(--bg-2)); color:var(--text);}
.wrap{max-width:1000px;margin:20px auto;padding:20px}
.card{background:var(--card);border-radius:14px;padding:20px;box-shadow:0 8px 24px rgba(3,6,18,0.6);border:1px solid rgba(255,255,255,0.02)}
.btn{padding:10px 16px;border-radius:12px;border:0;background:var(--accent-1);color:#fff;font-weight:700;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid var(--accent-1);color:var(--accent-1)}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;z-index:100}
.modal{background:var(--card);border-radius:12px;padding:20px;width:300px;box-shadow:0 8px 30px rgba(0,0,0,0.7);}
input{width:100%;padding:8px;border-radius:8px;border:1px solid #444;background:var(--bg-2);color:#fff;margin-top:6px}
#poolTable{background:#061226;border-radius:10px;width:100%;height:400px;margin-top:20px;position:relative}
.ball{width:24px;height:24px;border-radius:50%;position:absolute;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:12px}
.ball.player{background:var(--accent-1)}
.ball.bot{background:var(--accent-2)}
.hidden{display:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>Pool Game — Play against Bot</h2>
    <p>Entry Fee: ₦20 per round</p>
    <button id="playBtn" class="btn">Play</button>
    <div id="statusMsg" style="margin-top:12px;color:var(--muted)">Not in round</div>

    <div id="poolTable"></div>
  </div>
</div>

<!-- Modal -->
<div id="confirmModal" class="modal-bg">
  <div class="modal">
    <h3>Confirm Play</h3>
    <p>You will be debited ₦20 to join a round.</p>
    <label>Enter Round ID:</label>
    <input type="text" id="roundInput" placeholder="round_xxxxx">
    <div style="margin-top:12px;text-align:right">
      <button id="confirmJoin" class="btn">Confirm</button>
      <button id="cancelJoin" class="btn-ghost">Cancel</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
import { getFirestore, doc, getDoc, updateDoc, setDoc, arrayUnion } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';

// Firebase setup
const firebaseConfig = {
  apiKey: 'AIzaSyDy_L7uJeoaWXbUB-LVk_fBv8yHeRjNjZk',
  authDomain: 'beni-wealths.firebaseapp.com',
  projectId: 'beni-wealths',
  storageBucket: 'beni-wealths.firebasestorage.app',
  messagingSenderId: '807950483822',
  appId: '1:807950483822:web:e10fa87307e041c4d8417f',
  measurementId: 'G-Z2XP3YN6NS'
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let user = null;
let joinedRounds = new Set();

onAuthStateChanged(auth, u => { if(u) user=u; else alert('Sign in required'); });

// UI refs
const playBtn = document.getElementById('playBtn');
const confirmModal = document.getElementById('confirmModal');
const roundInput = document.getElementById('roundInput');
const confirmJoin = document.getElementById('confirmJoin');
const cancelJoin = document.getElementById('cancelJoin');
const statusMsg = document.getElementById('statusMsg');
const poolTable = document.getElementById('poolTable');

// dummy pool balls
let balls = [];

function renderTable(){
  poolTable.innerHTML = '';
  balls.forEach(b=>{
    const el = document.createElement('div');
    el.className = 'ball ' + b.type;
    el.style.left = b.x+'px';
    el.style.top = b.y+'px';
    el.textContent = b.id;
    poolTable.appendChild(el);
  });
}

// bot medium shot
function botPlay(){
  const ball = balls.find(b=>b.type==='bot');
  if(!ball) return;
  const dx = Math.random()*100-50;
  const dy = Math.random()*100-50;
  ball.x = Math.min(Math.max(ball.x+dx,0),poolTable.clientWidth-24);
  ball.y = Math.min(Math.max(ball.y+dy,0),poolTable.clientHeight-24);
  renderTable();
}

// start round
function startRound(roundId){
  if(joinedRounds.has(roundId)){
    alert('Already joined this round');
    return;
  }
  joinedRounds.add(roundId);

  // debit user 20 naira
  // In production: update firestore balance
  alert('₦20 debited for round ' + roundId);

  // initialize table
  balls = [
    {id:'P', x:50, y:180, type:'player'},
    {id:'B', x:400, y:180, type:'bot'}
  ];
  renderTable();
  statusMsg.textContent = 'In round ' + roundId;

  // simulate bot movement every 2s
  setInterval(botPlay,2000);
}

// event listeners
playBtn.addEventListener('click',()=>{confirmModal.style.display='flex';});
cancelJoin.addEventListener('click',()=>{confirmModal.style.display='none';});
confirmJoin.addEventListener('click',()=>{
  const rid = roundInput.value.trim();
  if(!rid){alert('Enter round ID'); return;}
  confirmModal.style.display='none';
  startRound(rid);
});
</script>
</body>
</html>
