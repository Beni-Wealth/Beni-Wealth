<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Snakes & Ladders Leaderboard ‚Äî Beni-Wealth</title>

  <!-- Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32"
        href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">

  <style>
    :root{
      --bg:#041225;
      --card:#0b1220;
      --accent:#7a5fff;
      --muted:rgba(255,255,255,0.65);
      --text:#eaf2ff;
      font-family:Poppins,system-ui,Arial;
    }
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,var(--bg),#031022);color:var(--text);padding:20px;display:flex;justify-content:center}
    .container{width:100%;max-width:800px}
    h1{text-align:center;font-weight:800;margin-bottom:12px}
    .list{margin-top:20px;border-radius:12px;overflow:hidden}
    .item{display:flex;justify-content:space-between;align-items:center;padding:14px;background:var(--card);border-bottom:1px solid rgba(255,255,255,0.08)}
    .item:last-child{border-bottom:none}
    .rank{font-weight:700;width:32px;text-align:center}
    .name{flex:1;padding-left:12px;font-size:15px}
    .wins{font-weight:700;font-size:15px;color:var(--accent)}
    .empty{text-align:center;color:var(--muted);padding:40px}
    .controls{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:12px}
    .btn{padding:8px 14px;border-radius:10px;border:none;background:var(--accent);color:#041219;font-weight:700;cursor:pointer}
  </style>
</head>

<body>
  <div class="container">
    <h1>üèÜ Snakes & Ladders Leaderboard</h1>

    <div class="controls">
      <button id="refreshBtn" class="btn">Refresh</button>
    </div>

    <div id="list" class="list">
      <div class="empty">Loading leaderboard‚Ä¶</div>
    </div>
  </div>

  <script type="module">
    import { initializeApp, getApps, getApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDy_L7uJeoaWXbUB-LVk_fBv8yHeRjNjZk",
      authDomain: "beni-wealths.firebaseapp.com",
      projectId: "beni-wealths",
      storageBucket: "beni-wealths.firebasestorage.app",
      messagingSenderId: "807950483822",
      appId: "1:807950483822:web=e10fa87307e041c4d8417f",
      measurementId: "G-Z2XP3YN6NS"
    };

    const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const listEl = document.getElementById('list');
    const refreshBtn = document.getElementById('refreshBtn');

    async function loadLeaderboard(){
      listEl.innerHTML = `<div class="empty">Loading leaderboard‚Ä¶</div>`;
      try {
        const snap = await getDocs(collection(db, 'snakesAndLaddersResults'));
        const counts = {};

        snap.forEach(doc => {
          const d = doc.data();
          if(!d.user) return; // skip entries without user
          // Only count **wins by real users**
          if(d.winner === 'player'){
            const uid = d.user;
            if(!counts[uid]) counts[uid] = 0;
            counts[uid]++;
          }
        });

        const arr = Object.entries(counts).map(([uid, wins]) => ({ uid, wins }));

        if(arr.length === 0){
          listEl.innerHTML = `<div class="empty">No user wins yet</div>`;
          return;
        }

        // sort by number of wins descending
        arr.sort((a,b) => b.wins - a.wins);

        listEl.innerHTML = '';
        arr.forEach((item, i) => {
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `
            <div class="rank">${i+1}</div>
            <div class="name">${item.uid}</div>
            <div class="wins">${item.wins} win${item.wins===1?'':'s'}</div>
          `;
          listEl.appendChild(div);
        });

      } catch (e) {
        console.error(e);
        listEl.innerHTML = `<div class="empty">Failed to load leaderboard</div>`;
      }
    }

    refreshBtn.onclick = loadLeaderboard;
    loadLeaderboard();
  </script>
</body>
</html>
