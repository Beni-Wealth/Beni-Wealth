<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Snakes & Ladders Leaderboard ‚Äî Beni-Wealth</title>

  <!-- Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32"
        href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">

  <style>
    :root {
      --bg: #041225;
      --card-bg: #0b1220;
      --accent: #7a5fff;
      --accent-light: #a179ff;
      --muted: rgba(255,255,255,0.65);
      --text: #eaf2ff;
      --gold: #f1c40f;
      --silver: #bdc3c7;
      --bronze: #cd7f32;
      --radius: 12px;
      --spacing: 14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding: 20px;
      font-family: Poppins, system-ui, Arial;
      background: linear-gradient(180deg, var(--bg), #031022);
      color: var(--text);
      display:flex;justify-content:center;
    }
    .container { width:100%;max-width:800px; }
    h1 {
      text-align:center;
      font-weight:800;
      margin-bottom:12px;
      font-size:1.8rem;
      color: var(--accent-light);
      text-shadow: 1px 1px 4px rgba(0,0,0,0.6);
    }
    .controls {
      display:flex; justify-content:center; margin-bottom:18px;
    }
    .btn {
      padding:10px 18px; border:none; border-radius:var(--radius);
      background: linear-gradient(90deg,var(--accent-light),var(--accent));
      color:#041219; font-weight:700; cursor:pointer;
      font-size:14px;
      box-shadow:0 6px 18px rgba(122,95,255,0.25);
      transition: transform .15s ease;
    }
    .btn:hover { transform: scale(1.04); }

    table {
      width:100%; border-collapse:collapse;
      font-size:15px;
      background: var(--card-bg);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }
    th, td {
      padding: var(--spacing);
      text-align:left;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    th {
      background: linear-gradient(90deg,var(--accent),var(--accent-light));
      color:#041219;
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
    }
    tbody tr:hover {
      background: rgba(255,255,255,0.05);
    }

    .rank-1 td:first-child { color: var(--gold); font-weight:700; }
    .rank-2 td:first-child { color: var(--silver); font-weight:700; }
    .rank-3 td:first-child { color: var(--bronze); font-weight:700; }

    .empty {
      text-align:center; padding:60px;
      color: var(--muted); font-size: 1.1rem;
    }

    @media(max-width:600px){
      th, td { padding:10px; font-size:13px; }
      h1 { font-size:1.5rem; }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üèÜ Snakes & Ladders Leaderboard</h1>
    <div class="controls">
      <button id="refreshBtn" class="btn">Refresh</button>
    </div>

    <div id="list">
      <div class="empty">Loading leaderboard‚Ä¶</div>
    </div>
  </div>

  <script type="module">
    import { initializeApp, getApps, getApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDy_L7uJeoaWXbUB-LVk_fBv8yHeRjNjZk",
      authDomain: "beni-wealths.firebaseapp.com",
      projectId: "beni-wealths",
      storageBucket: "beni-wealths.firebasestorage.app",
      messagingSenderId: "807950483822",
      appId: "1:807950483822:web=e10fa87307e041c4d8417f",
      measurementId: "G-Z2XP3YN6NS"
    };

    const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const listEl = document.getElementById('list');
    const refreshBtn = document.getElementById('refreshBtn');

    const obfuscate = uid => {
      if(!uid) return '';
      const start = uid.slice(0,4);
      const end = uid.slice(-4);
      return `${start}‚Ä¶${end}`;
    };

    async function loadLeaderboard(){
      listEl.innerHTML = `<div class="empty">Loading leaderboard‚Ä¶</div>`;
      try {
        const snap = await getDocs(collection(db, 'snakesAndLaddersResults'));
        const counts = {};
        snap.forEach(doc => {
          const d = doc.data();
          if(d.winner === 'player' && d.user){
            counts[d.user] = (counts[d.user]||0) + 1;
          }
        });

        const arr = Object.entries(counts).map(([uid,wins]) => ({uid,wins}));
        if(arr.length === 0){
          listEl.innerHTML = `<div class="empty">No wins yet</div>`;
          return;
        }

        arr.sort((a,b) => b.wins - a.wins);

        let html = `<table><thead>
          <tr><th>Rank</th><th>Player</th><th style="text-align:right">Wins</th></tr></thead><tbody>`;
        arr.forEach((item,i) => {
          const cls = `rank-${i+1}`;
          html += `<tr class="${cls}">
                    <td>${i+1}</td>
                    <td>${obfuscate(item.uid)}</td>
                    <td style="text-align:right">${item.wins}</td>
                  </tr>`;
        });
        html += `</tbody></table>`;
        listEl.innerHTML = html;

      } catch (e) {
        console.error(e);
        listEl.innerHTML = `<div class="empty">Failed to load leaderboard</div>`;
      }
    }

    refreshBtn.onclick = loadLeaderboard;
    loadLeaderboard();
  </script>
</body>
</html>
