<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tasks — Beni-Wealth</title>

  <!-- Poppins -->

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>

  <!-- Favicons & Social preview (STANDARD) -->

  <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <meta name="msapplication-TileImage" content="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Beni-Wealth — Earn Steadily">
  <meta property="og:description" content="Complete simple micro-tasks, ptcs, blogs & shortlinks and earn instantly.">
  <meta property="og:image" content="https://res.cloudinary.com/dq7fpxfbc/image/upload/c_fill,w_1200,h_630/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#2fe0b8">

  <style>
    body{margin:0;background:#0b0613;color:#eaf2ff;font-family:Poppins,sans-serif}
    .container{max-width:420px;margin:auto;padding:20px}
    label{font-size:13px;font-weight:600}
    textarea,input{width:100%;margin-top:6px;padding:10px;border-radius:8px;background:#0f0820;border:1px solid rgba(255,255,255,.1);color:#fff}
    .btn{margin-top:14px;width:100%;padding:12px;border:none;border-radius:10px;font-weight:700;background:#35d6b1;color:#041219;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
  </style>

</head>
<body>

<div class="container">
  <h2>Submit Task Proof</h2>

<label>Text proof <span style="color:#ff7a7a">*</span></label>

  <textarea id="proofText" placeholder="Describe what you did or paste link"></textarea>

<label style="margin-top:12px">Image proof <span style="color:#ff7a7a">*</span></label> <input id="proofImage" type="file" accept="image/*" />

<button id="submitBtn" class="btn">Submit Proof</button>

</div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
  import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
  import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';

  const firebaseConfig = {
    apiKey: "AIzaSyDy_L7uJeoaWXbUB-LVk_fBv8yHeRjNjZk",
    authDomain: "beni-wealths.firebaseapp.com",
    projectId: "beni-wealths",
    storageBucket: "beni-wealths.firebasestorage.app",
    messagingSenderId: "807950483822",
    appId: "1:807950483822:web:e10fa87307e041c4d8417f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  let currentUser = null;
  onAuthStateChanged(auth, u => currentUser = u);

  async function uploadImgur(file){
    const form = new FormData();
    form.append('image', file);
    const res = await fetch('https://api.imgur.com/3/image',{
      method:'POST',
      headers:{Authorization:'Client-ID fb533db21a59486'},
      body:form
    });
    const j = await res.json();
    if(!j.success) throw new Error('Image upload failed');
    return j.data.link;
  }

  const submitBtn = document.getElementById('submitBtn');
  const proofText = document.getElementById('proofText');
  const proofImage = document.getElementById('proofImage');

  submitBtn.addEventListener('click', async () => {
    const text = proofText.value.trim();
    const file = proofImage.files[0];

    // ❌ BLOCK text-only OR image-only submissions
    if (!text || !file) {
      alert('You must submit BOTH text proof and image proof.');
      return;
    }

    if (!currentUser) {
      alert('Please sign in first.');
      return;
    }

    try {
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting…';

      const imageUrl = await uploadImgur(file);

      await addDoc(collection(db, 'task_submissions'), {
        userId: currentUser.uid,
        textProof: text,
        imageUrl,
        status: 'pending',
        createdAt: serverTimestamp()
      });

      alert('Proof submitted successfully.');
      proofText.value = '';
      proofImage.value = '';
    } catch (e) {
      alert(e.message || 'Submission failed');
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Proof';
    }
  });
</script>

</body>
</html>
