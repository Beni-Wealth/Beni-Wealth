<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Beni-Wealth — Register</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300,400,600,700&display=swap" rel="stylesheet">

  <!-- Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>

  <!-- Favicons & Social preview -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <meta name="msapplication-TileImage" content="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Beni-Wealth — Earn Steadily">
  <meta property="og:description" content="Complete simple micro-tasks, complete ptcs and blogs, complete shortlinks and earn instantly. Advertise efficiently with transparent metrics and fast payouts.">
  <meta property="og:image" content="https://res.cloudinary.com/dq7fpxfbc/image/upload/c_fill,w_1200,h_630/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#2fe0b8">

  <style>
    :root{
      --bg-1:#0b0613;
      --bg-2:#0f0820;
      --muted:rgba(233,240,255,0.62);
      --card: rgba(255,255,255,0.02);
      --accent-start:#2fe0b8;
      --accent-end:#7a5fff;
      --glass: rgba(255,255,255,0.03);
      --text: #e9f0ff;
      --danger: #ff6b6b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family:'Poppins',system-ui,Segoe UI,Arial, sans-serif;
      background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color: var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }

    .card {
      width:100%;
      max-width:420px;
      border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:28px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.6);
      animation: enter .28s ease;
    }
    @keyframes enter { from { opacity:0; transform: translateY(12px); } to { opacity:1; transform:none } }

    /* Centered Logo */
    .logo-centered {
      display: flex;
      justify-content: center;
      margin-bottom: 14px;
    }
    .logo-centered img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 8px 28px rgba(122,95,255,0.12);
    }

    .title-center,
    .lead-center {
      text-align: center;
      margin: 0 auto;
    }
    .title-center {
      font-size: 22px;
      margin-bottom: 6px;
    }
    .lead-center {
      margin-top: 4px;
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 18px;
    }

    form { display:flex; flex-direction:column; gap:12px; }
    label{ font-size:13px; color:var(--muted); }

    input[type="text"], input[type="email"], input[type="password"] {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.04);
      padding:12px 14px;
      border-radius:10px;
      color:var(--text);
      font-size:14px;
      outline: none;
      transition: box-shadow .12s, border-color .12s;
      box-sizing: border-box;
      height:48px;
      line-height:1.2;
    }
    input::placeholder{ color: rgba(233,240,255,0.28) }
    input:focus{ box-shadow: 0 6px 20px rgba(47,224,184,0.06); border-color: rgba(127,90,255,0.14) }

    input[disabled]{
      background: rgba(255,255,255,0.01);
      color: rgba(233,240,255,0.6);
      border-color: rgba(255,255,255,0.02);
      cursor: not-allowed;
    }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap:12px; }

    .error { color: var(--danger); font-size:13px; height:18px; margin-top:6px; }
    .actions { display:flex; gap:12px; margin-top:6px; align-items:center; }
    .btn {
      padding:12px 14px;
      border-radius:12px;
      background: linear-gradient(90deg,var(--accent-start),var(--accent-end));
      color:#041219;
      font-weight:700;
      border:0;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .btn[disabled]{ opacity:0.6; cursor:not-allowed }
    .btn.secondary{
      background:transparent;
      border:1px solid rgba(255,255,255,0.04);
      color:var(--text);
    }

    .spinner {
      width:18px; height:18px;
      border-radius:50%;
      border:3px solid rgba(4,6,9,0.08);
      border-top-color: rgba(4,6,9,0.18);
      animation: spin 1s linear infinite;
      display:none;
    }
    .spinner.show{ display:inline-block }
    @keyframes spin { to { transform: rotate(360deg) } }

    .muted { color:var(--muted); font-size:13px; margin-top:10px; text-align:center }
    .ref-note { font-size:13px; color:var(--muted); margin-top:6px; }

    @media (max-width:420px){
      .card{ padding:18px; }
      .logo-centered img{ width:64px; height:64px }
      .row { grid-template-columns: 1fr; }
      input[type="text"], input[type="email"], input[type="password"] { height:46px; }
    }
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="registerTitle">

    <!-- Centered Logo -->
    <div class="logo-centered">
      <img src="https://res.cloudinary.com/dq7fpxfbc/image/upload/v1752962852/file_00000000401861f8bf6acb6d55fcf2bf_g2fcrf.png" alt="Beni-Wealth logo">
    </div>

    <h1 id="registerTitle" class="title-center">Create your Beni-Wealth account</h1>
    <p class="lead lead-center">Quick signup — receive notifications and earn instantly.</p>

    <form id="registerForm" novalidate>
      <input id="fullName" name="fullName" type="text" placeholder="Full name" required autocomplete="name" />
      <input id="username" name="username" type="text" placeholder="Username" required autocomplete="username" />

      <div>
        <input id="referral" name="referral" type="text" placeholder="Referral code (optional)" disabled />
        <div id="refNote" class="ref-note" aria-live="polite" style="display:none"></div>
      </div>

      <input id="email" name="email" type="email" placeholder="Email address" required autocomplete="email" />
      <div class="row">
        <div><input id="password" name="password" type="password" placeholder="Password (min 6)" minlength="6" required autocomplete="new-password" /></div>
        <div><input id="confirmPassword" name="confirmPassword" type="password" placeholder="Confirm password" minlength="6" required autocomplete="new-password" /></div>
      </div>

      <div id="errorText" class="error" role="alert" aria-live="assertive"></div>

      <div class="actions">
        <button id="submitBtn" class="btn" type="submit" aria-live="polite">
          <span class="spinner" id="spinner"></span>
          <span id="btnText">Register</span>
        </button>
        <button type="button" id="signinBtn" class="btn secondary" onclick="location.href='login.html'">Sign in</button>
      </div>

      <div class="muted">By creating an account you agree to our <a href="terms.html" style="color:rgba(233,240,255,0.9)">terms</a>.</div>
    </form>
  </main>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, fetchSignInMethodsForEmail, updateProfile } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    import { getFirestore, doc, setDoc, serverTimestamp, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDy_L7uJeoaWXbUB-LVk_fBv8yHeRjNjZk",
      authDomain: "beni-wealths.firebaseapp.com",
      projectId: "beni-wealths",
      storageBucket: "beni-wealths.firebasestorage.app",
      messagingSenderId: "807950483822",
      appId: "1:807950483822:web:e10fa87307e041c4d8417f",
      measurementId: "G-Z2XP3YN6NS"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const form = document.getElementById('registerForm');
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    const btnText = document.getElementById('btnText');
    const errorText = document.getElementById('errorText');
    const referralInput = document.getElementById('referral');
    const refNote = document.getElementById('refNote');
    const usernameInput = document.getElementById('username');

    function showError(msg){ errorText.textContent = msg || ''; }
    function setLoading(isLoading){
      submitBtn.disabled = isLoading;
      spinner.classList.toggle('show', isLoading);
      btnText.textContent = isLoading ? 'Please wait…' : 'Register';
    }

    async function isUsernameTaken(name){
      try{
        if(!name) return true;
        const q = query(collection(db, 'users'), where('username', '==', name));
        const snap = await getDocs(q);
        return !snap.empty;
      }catch(e){
        console.error('username check failed', e);
        return false;
      }
    }

    function sanitizeReferral(raw){
      if(!raw) return null;
      const t = String(raw).trim();
      if(!t) return null;
      const cleaned = t.replace(/[^\w-]/g, '').slice(0,40);
      return cleaned || null;
    }

    (function prefillReferralFromURL(){
      try{
        const sp = new URLSearchParams(window.location.search);
        const candidate = sp.get('ref') || sp.get('referral') || sp.get('r') || sp.get('refcode');
        const sanitized = sanitizeReferral(candidate);
        if(sanitized){
          referralInput.value = sanitized;
          refNote.style.display = 'block';
          refNote.textContent = `Referral code applied: ${sanitized}`;
        } else {
          referralInput.value = '';
          refNote.style.display = 'block';
          refNote.textContent = 'Referral code (not provided)';
        }
      }catch(e){
        referralInput.value = '';
        refNote.style.display = 'block';
        refNote.textContent = 'Referral code (not provided)';
      }
    })();

    referralInput.addEventListener('keydown', (e) => e.preventDefault());
    referralInput.addEventListener('paste', (e) => e.preventDefault());
    referralInput.addEventListener('input', (e) => { referralInput.value = referralInput.value; });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      showError('');
      setLoading(true);

      const fullName = document.getElementById('fullName').value.trim();
      const username = usernameInput.value.trim();
      const rawReferral = referralInput.value ? String(referralInput.value).trim() : '';
      const referral = sanitizeReferral(rawReferral);
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('confirmPassword').value;

      if(!fullName || !username || !email || !password || !confirm){
        showError('Please fill all required fields.');
        setLoading(false);
        return;
      }
      if(password !== confirm){
        showError('Passwords do not match.');
        setLoading(false);
        return;
      }
      if(password.length < 6){
        showError('Password must be at least 6 characters.');
        setLoading(false);
        return;
      }

      const willIgnoreReferral = referral && referral.toLowerCase() === username.toLowerCase();

      try{
        const methods = await fetchSignInMethodsForEmail(auth, email);
        if(methods && methods.length > 0){
          throw new Error('Email already in use.');
        }
        const taken = await isUsernameTaken(username);
        if(taken){
          throw new Error('Username is already taken. Choose another.');
        }

        const cred = await createUserWithEmailAndPassword(auth, email, password);
        const user = cred.user;

        try{ await updateProfile(user, { displayName: username }); } catch(upErr){ console.warn('updateProfile failed', upErr); }

        try{ await sendEmailVerification(user); } catch(verr){ console.warn('sendEmailVerification failed', verr); }

        const referralValue = (referral && !willIgnoreReferral) ? referral : null;

        const payload = {
          fullName: fullName || '',
          username: username,
          email: user.email || email,
          balance: 0,
          plan: 'basic',
          createdAt: serverTimestamp(),
          referral: referralValue,
          referrer: referralValue,
          referredBy: referralValue,
          referralCode: referralValue || username
        };

        await setDoc(doc(db, 'users', user.uid), payload);

        setLoading(false);
        alert('Account created — verification email sent (check your inbox). Redirecting to login.');
        window.location.href = 'login.html';
      }catch(err){
        console.error('Registration error', err);
        showError(err.message || 'Registration failed. Try again.');
        setLoading(false);
      }
    });
  </script>
</body>
</html>
